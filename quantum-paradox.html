<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Paradox - StoryPaths</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto+Mono:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Roboto Mono', monospace;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: #00f5ff;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            letter-spacing: 0.5px;
            overflow-x: hidden;
        }
        
        .story-container {
            width: 95%;
            max-width: 700px;
            height: 90vh;
            display: flex;
            flex-direction: column;
            position: relative;
            border: 1px solid rgba(0, 245, 255, 0.2);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(5px);
        }
        
        .header-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid rgba(0, 245, 255, 0.2);
            background: rgba(0, 0, 0, 0.2);
        }
        
        .quantum-stability {
            color: #00ff87;
            font-size: 11px;
            opacity: 0.9;
            animation: quantumFlicker 3s infinite;
            font-family: 'Orbitron', sans-serif;
            font-weight: 500;
        }
        
        .timeline-status {
            color: #ff6b6b;
            font-size: 11px;
            opacity: 0.9;
            font-family: 'Orbitron', sans-serif;
            font-weight: 500;
        }
        
        .paradox-level {
            color: #ffd93d;
            font-size: 11px;
            opacity: 0.9;
            font-family: 'Orbitron', sans-serif;
            font-weight: 500;
        }
        
        .scenario-info {
            text-align: center;
            margin: 15px;
            padding: 12px;
            border: 1px solid rgba(0, 245, 255, 0.3);
            border-radius: 6px;
            background: linear-gradient(45deg, rgba(0, 245, 255, 0.05), rgba(255, 107, 107, 0.05));
        }
        
        .scenario-title {
            color: #ff6b6b;
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 6px;
            font-family: 'Orbitron', sans-serif;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .scenario-desc {
            color: #888;
            font-size: 10px;
            opacity: 0.8;
            line-height: 1.4;
        }
        
        .message-area {
            flex-grow: 1;
            overflow-y: auto;
            margin: 0 20px 20px 20px;
            padding-right: 10px;
        }
        
        .message {
            margin-bottom: 15px;
            animation: dataStream 0.8s ease-in;
            padding: 12px;
            border-radius: 6px;
            border-left: 3px solid transparent;
            background: rgba(0, 0, 0, 0.2);
        }
        
        .message p {
            margin: 0;
            line-height: 1.6;
        }
        
        .narrator {
            border-left-color: #00f5ff;
            color: #e6ffff;
            background: rgba(0, 245, 255, 0.05);
        }
        
        .quantum {
            border-left-color: #00ff87;
            color: #00ff87;
            background: rgba(0, 255, 135, 0.05);
            font-style: italic;
        }
        
        .system {
            border-left-color: #666;
            color: #999;
            background: rgba(102, 102, 102, 0.05);
            font-style: italic;
            font-size: 12px;
        }
        
        .user-choice {
            border-left-color: #ffd93d;
            color: #ffd93d;
            background: rgba(255, 217, 61, 0.05);
            font-weight: 500;
        }
        
        .discovery {
            border-left-color: #ff6b6b;
            color: #ff6b6b;
            background: rgba(255, 107, 107, 0.05);
        }
        
        .temporal {
            border-left-color: #a78bfa;
            color: #a78bfa;
            background: rgba(167, 139, 250, 0.05);
            font-style: italic;
        }
        
        .choices {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 0 20px 20px 20px;
        }
        
        .choice-button {
            background: linear-gradient(45deg, rgba(0, 245, 255, 0.05), rgba(255, 107, 107, 0.05));
            border: 1px solid rgba(0, 245, 255, 0.3);
            border-radius: 6px;
            padding: 16px;
            color: #e6ffff;
            text-align: left;
            cursor: pointer;
            transition: all 0.4s ease;
            font-family: 'Roboto Mono', monospace;
            font-size: 13px;
            position: relative;
            overflow: hidden;
        }
        
        .choice-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 245, 255, 0.1), transparent);
            transition: left 0.5s;
        }
        
        .choice-button:hover::before {
            left: 100%;
        }
        
        .choice-button:hover {
            background: linear-gradient(45deg, rgba(0, 245, 255, 0.1), rgba(255, 107, 107, 0.1));
            border-color: rgba(0, 245, 255, 0.6);
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 245, 255, 0.2);
        }
        
        .choice-timer {
            position: absolute;
            top: 8px;
            right: 12px;
            font-size: 9px;
            color: #00ff87;
            opacity: 0.7;
            font-family: 'Orbitron', sans-serif;
        }
        
        .paywall-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.9), rgba(26, 26, 46, 0.9));
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 100;
            backdrop-filter: blur(10px);
        }
        
        .paywall-container {
            width: 90%;
            max-width: 400px;
            border: 1px solid rgba(0, 245, 255, 0.4);
            border-radius: 8px;
            padding: 30px;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.8), rgba(26, 26, 46, 0.8));
            backdrop-filter: blur(15px);
            font-family: 'Roboto Mono', monospace;
        }
        
        .paywall-title {
            font-size: 20px;
            font-weight: 700;
            margin: 0 0 20px 0;
            color: #ff6b6b;
            letter-spacing: 1px;
            font-family: 'Orbitron', sans-serif;
            text-transform: uppercase;
        }
        
        .paywall-text {
            font-size: 14px;
            opacity: 0.9;
            margin: 0 0 25px 0;
            line-height: 1.6;
            color: #e6ffff;
        }
        
        .price {
            display: flex;
            justify-content: space-between;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0, 245, 255, 0.2);
        }
        
        .price-label {
            opacity: 0.7;
            color: #888;
        }
        
        .price-amount {
            font-size: 18px;
            font-weight: 700;
            color: #00ff87;
            font-family: 'Orbitron', sans-serif;
        }
        
        .continue-button {
            background: linear-gradient(45deg, #00f5ff, #ff6b6b);
            color: #000;
            border: none;
            border-radius: 6px;
            padding: 14px 0;
            width: 100%;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            font-family: 'Orbitron', sans-serif;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .continue-button:hover {
            background: linear-gradient(45deg, #ff6b6b, #00f5ff);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 245, 255, 0.3);
        }
        
        .return-link {
            display: block;
            text-align: center;
            color: rgba(230, 255, 255, 0.5);
            font-size: 12px;
            text-decoration: none;
            transition: all 0.2s ease;
        }
        
        .return-link:hover {
            color: rgba(230, 255, 255, 0.8);
        }
        
        .outcome-summary {
            display: none;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.6), rgba(26, 26, 46, 0.6));
            border: 1px solid rgba(0, 245, 255, 0.3);
            border-radius: 8px;
            padding: 25px;
            margin: 20px;
            text-align: center;
        }
        
        .outcome-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 15px;
            color: #ff6b6b;
            font-family: 'Orbitron', sans-serif;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .outcome-stats {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-item {
            text-align: center;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            border: 1px solid rgba(0, 245, 255, 0.2);
        }
        
        .stat-value {
            font-size: 16px;
            font-weight: 700;
            display: block;
            color: #00ff87;
            font-family: 'Orbitron', sans-serif;
        }
        
        .stat-label {
            font-size: 9px;
            opacity: 0.7;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 5px;
        }
        
        .restart-button {
            background: rgba(0, 245, 255, 0.1);
            border: 1px solid rgba(0, 245, 255, 0.3);
            color: #e6ffff;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-family: 'Roboto Mono', monospace;
            font-size: 12px;
            margin: 8px;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .restart-button:hover {
            background: rgba(0, 245, 255, 0.2);
            transform: translateY(-1px);
        }
        
        @keyframes dataStream {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        @keyframes quantumFlicker {
            0% { opacity: 0.7; }
            25% { opacity: 1; }
            50% { opacity: 0.8; }
            75% { opacity: 1; }
            100% { opacity: 0.7; }
        }
        
        .typing-indicator {
            color: #666;
            font-style: italic;
            opacity: 0.7;
            animation: quantumFlicker 2s infinite;
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .story-container {
                width: 98%;
                height: 95vh;
                margin: 10px;
            }
            
            .header-info {
                flex-direction: column;
                gap: 8px;
                align-items: flex-start;
                padding: 12px 15px;
            }
            
            .outcome-stats {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .scenario-title {
                font-size: 12px;
            }
            
            .choice-button {
                font-size: 12px;
                padding: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="story-container">
        <div class="header-info">
            <div class="quantum-stability" id="quantumStability">⚛ QUANTUM: STABLE</div>
            <div class="timeline-status" id="timelineStatus">⏰ TIMELINE: PRIMARY</div>
            <div class="paradox-level" id="paradoxLevel">⚠ PARADOX: NONE</div>
        </div>
        
        <div class="scenario-info">
            <div class="scenario-title">EXPERIMENT 7: TEMPORAL BREACH</div>
            <div class="scenario-desc">Quantum Research Lab • Timeline displacement detected • Reality anchor failing • Choose carefully</div>
        </div>
        
        <div class="message-area" id="messageArea">
            <div class="message system">
                <p>SYSTEM STATUS: Quantum field destabilizing • Timeline integrity: 87%</p>
            </div>
            
            <div class="message quantum">
                <p>Emergency protocols activated. The quantum drive has malfunctioned during your consciousness transfer experiment.</p>
            </div>
            
            <div class="message narrator">
                <p>You're Dr. Alex Chen, lead quantum physicist. Around you, reality flickers between multiple timelines. In one, the lab is destroyed. In another, you never existed. The quantum anchors are failing rapidly.</p>
            </div>
            
            <div class="message temporal">
                <p>You have approximately 4 minutes before complete timeline collapse. Your next action will determine which reality becomes permanent.</p>
            </div>
        </div>
        
        <div class="choices" id="choices">
            <button class="choice-button" onclick="makeChoice('emergency_shutdown')">
                <span class="choice-timer">240s</span>
                Initiate emergency quantum drive shutdown
            </button>
            
            <button class="choice-button" onclick="makeChoice('stabilize_field')">
                <span class="choice-timer">240s</span>
                Attempt to manually stabilize the quantum field
            </button>
        </div>
        
        <div class="outcome-summary" id="outcomeSummary">
            <div class="outcome-title" id="outcomeTitle">EXPERIMENT COMPLETE</div>
            <div class="outcome-stats">
                <div class="stat-item">
                    <span class="stat-value" id="finalQuantum">STABLE</span>
                    <span class="stat-label">Quantum State</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="finalTimeline">PRIMARY</span>
                    <span class="stat-label">Timeline</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="paradoxCount">0</span>
                    <span class="stat-label">Paradoxes</span>
                </div>
            </div>
            <div id="outcomeDescription"></div>
            <button class="restart-button" onclick="restartStory()">TRY AGAIN</button>
            <button class="restart-button" onclick="window.location.href='index.html'">OTHER STORIES</button>
        </div>
    </div>
    
    <div class="paywall-overlay" id="paywall">
        <div class="paywall-container">
            <h1 class="paywall-title">QUANTUM ACCESS REQUIRED</h1>
            <p class="paywall-text">Reality is fracturing. Only authorized personnel can access the quantum stabilization protocols needed to continue.</p>
            
            <div class="price">
                <span class="price-label">Full experiment access:</span>
                <span class="price-amount">$4.99</span>
            </div>
            
            <button class="continue-button" onclick="unlockStory()">UNLOCK FOR $4.99</button>
            
            <a href="index.html" class="return-link">Return to laboratory</a>
        </div>
    </div>
    
    <script>
        // Game state
        let gameState = {
            quantumStability: 100,
            timelineIntegrity: 87,
            paradoxes: 0,
            currentScene: 1,
            choices: [],
            isUnlocked: false
        };
        
        // Story data structure
        const storyData = {
            1: {
                emergency_shutdown: {
                    nextScene: 2,
                    quantumChange: -20,
                    timelineChange: 10,
                    paradoxChange: 0,
                    messages: [
                        { type: 'user-choice', text: 'Initiate emergency quantum drive shutdown' },
                        { type: 'narrator', text: 'You slam the emergency shutdown button. The quantum field begins to collapse, but power systems start failing throughout the facility.' },
                        { type: 'quantum', text: 'WARNING: Quantum field destabilizing. Emergency power systems offline. Containment breach imminent.' },
                        { type: 'discovery', text: 'The shutdown worked partially, but now dangerous quantum energy is leaking into the facility!' },
                        { type: 'temporal', text: 'You see glimpses of alternate timelines where this choice led to catastrophic failure.' }
                    ]
                },
                stabilize_field: {
                    nextScene: 3,
                    quantumChange: 0,
                    timelineChange: -15,
                    paradoxChange: 1,
                    messages: [
                        { type: 'user-choice', text: 'Attempt to manually stabilize the quantum field' },
                        { type: 'narrator', text: 'You rush to the quantum control panel, your hands flying over the complex interface as reality warps around you.' },
                        { type: 'quantum', text: 'Quantum resonance patterns realigning. Field fluctuations decreasing by 12%.' },
                        { type: 'temporal', text: 'You briefly see yourself in another timeline making the opposite choice. The paradox has begun.' },
                        { type: 'narrator', text: 'The field stabilizes somewhat, but your consciousness is now split across multiple realities.' }
                    ]
                }
            },
            2: {
                contain_breach: {
                    nextScene: 4,
                    quantumChange: 15,
                    timelineChange: 5,
                    paradoxChange: 0,
                    messages: [
                        { type: 'user-choice', text: 'Activate secondary containment protocols' },
                        { type: 'narrator', text: 'You race to the backup control room as quantum energy crackles through the corridors.' },
                        { type: 'quantum', text: 'Secondary containment fields activated. Quantum leak contained at 73% efficiency.' },
                        { type: 'discovery', text: 'The containment is holding, but the energy readings show something impossible - negative quantum mass!' },
                        { type: 'narrator', text: 'You have successfully contained the immediate threat, but the implications are staggering.' }
                    ]
                },
                evacuate_facility: {
                    nextScene: 5,
                    quantumChange: -30,
                    timelineChange: -10,
                    paradoxChange: 2,
                    messages: [
                        { type: 'user-choice', text: 'Evacuate the facility and let the breach run its course' },
                        { type: 'narrator', text: 'You sound the evacuation alarm and flee the facility with your research team.' },
                        { type: 'temporal', text: 'As you escape, you watch multiple versions of the facility existing simultaneously.' },
                        { type: 'quantum', text: 'Facility quantum breach expanding exponentially. Timeline fractures detected across 47 alternate realities.' },
                        { type: 'narrator', text: 'You saved lives, but the quantum breach is now affecting reality on a global scale.' }
                    ]
                }
            },
            3: {
                merge_timelines: {
                    nextScene: 6,
                    quantumChange: 25,
                    timelineChange: 30,
                    paradoxChange: 3,
                    messages: [
                        { type: 'user-choice', text: 'Attempt to merge your consciousness across timelines' },
                        { type: 'narrator', text: 'You focus on the quantum interface, trying to merge your split consciousness into a single timeline.' },
                        { type: 'temporal', text: 'Reality bends around you. You experience memories from dozens of alternate versions of yourself.' },
                        { type: 'quantum', text: 'Consciousness merger 67% complete. Timeline convergence initiated. WARNING: Identity matrix unstable.' },
                        { type: 'discovery', text: 'You have gained impossible knowledge from alternate realities, but at what cost to your sanity?' }
                    ]
                },
                isolate_paradox: {
                    nextScene: 7,
                    quantumChange: 10,
                    timelineChange: 5,
                    paradoxChange: -1,
                    messages: [
                        { type: 'user-choice', text: 'Isolate the paradox in a quantum bubble' },
                        { type: 'narrator', text: 'You use the remaining quantum energy to create an isolation field around the paradox.' },
                        { type: 'quantum', text: 'Quantum isolation field stable. Paradox contained within 12-meter sphere.' },
                        { type: 'temporal', text: 'The timeline fracture is healing, but the isolated paradox creates a permanent "dead zone" in reality.' },
                        { type: 'narrator', text: 'You have contained the paradox, but created a void in spacetime that will exist forever.' }
                    ]
                }
            },
            4: {
                study_negative_mass: {
                    nextScene: 'breakthrough',
                    quantumChange: 20,
                    timelineChange: 15,
                    paradoxChange: 0,
                    messages: [
                        { type: 'user-choice', text: 'Study the negative quantum mass phenomenon' },
                        { type: 'narrator', text: 'You carefully analyze the impossible readings, realizing you have discovered something revolutionary.' },
                        { type: 'discovery', text: 'The negative quantum mass could be the key to faster-than-light travel and time manipulation!' },
                        { type: 'quantum', text: 'Theoretical framework confirmed. Negative mass exhibits temporal displacement properties.' },
                        { type: 'narrator', text: 'Your discovery will change the course of human civilization. You have made scientific history.' }
                    ]
                },
                destroy_evidence: {
                    nextScene: 8,
                    quantumChange: 5,
                    timelineChange: 20,
                    paradoxChange: 0,
                    messages: [
                        { type: 'user-choice', text: 'Destroy all evidence of the experiment' },
                        { type: 'narrator', text: 'You realize the dangerous implications and systematically delete all research data.' },
                        { type: 'quantum', text: 'Data purge complete. Quantum signatures scrubbed from all recording devices.' },
                        { type: 'temporal', text: 'Timeline stabilizing to pre-experiment state. Reality anchor restored to 97% integrity.' },
                        { type: 'narrator', text: 'You have prevented a potential disaster, but scientific progress has been set back decades.' }
                    ]
                }
            },
            5: {
                become_observer: {
                    nextScene: 'multiverse',
                    quantumChange: -50,
                    timelineChange: -30,
                    paradoxChange: 10,
                    messages: [
                        { type: 'user-choice', text: 'Accept your role as a multiversal observer' },
                        { type: 'narrator', text: 'You stop fighting the quantum effects and allow yourself to exist across multiple timelines simultaneously.' },
                        { type: 'temporal', text: 'Your consciousness expands across infinite realities. You see the birth and death of countless universes.' },
                        { type: 'quantum', text: 'Observer state achieved. Subject exists in quantum superposition across 2,847 distinct timelines.' },
                        { type: 'discovery', text: 'You have become something beyond human - a conscious witness to the infinite multiverse.' }
                    ]
                },
                fight_reality: {
                    nextScene: 'resistance',
                    quantumChange: -20,
                    timelineChange: -20,
                    paradoxChange: 5,
                    messages: [
                        { type: 'user-choice', text: 'Fight to maintain your original timeline' },
                        { type: 'narrator', text: 'You use sheer willpower to anchor yourself to your original reality, fighting the quantum chaos.' },
                        { type: 'temporal', text: 'Timeline flux resistance detected. Original reality matrix strengthening through conscious effort.' },
                        { type: 'quantum', text: 'Quantum field partially stabilized through observer effect. Reality anchor at 34% integrity.' },
                        { type: 'narrator', text: 'Your determination is working, but the strain on your mind is enormous.' }
                    ]
                }
            }
        };
        
        // Ending scenarios
        const endings = {
            breakthrough: {
                title: "SCIENTIFIC BREAKTHROUGH",
                description: "Your careful handling of the crisis led to the discovery of negative quantum mass, revolutionizing physics forever.",
                quantum: "ENHANCED",
                timeline: "STABLE",
                paradoxes: 0
            },
            multiverse: {
                title: "MULTIVERSAL CONSCIOUSNESS",
                description: "You have transcended human limitations and now exist as a conscious observer across infinite realities.",
                quantum: "TRANSCENDENT",
                timeline: "INFINITE",
                paradoxes: 10
            },
            resistance: {
                title: "REALITY ANCHOR",
                description: "Through sheer willpower, you maintained timeline integrity despite impossible odds.",
                quantum: "STABILIZED",
                timeline: "RESTORED",
                paradoxes: 5
            },
            stabilized: {
                title: "QUANTUM STABILIZATION",
                description: "You successfully contained the quantum breach and restored normal spacetime.",
                quantum: "STABLE",
                timeline: "PRIMARY",
                paradoxes: 1
            },
            failure: {
                title: "QUANTUM CATASTROPHE",
                description: "The quantum breach has destabilized reality itself. The consequences will ripple across all timelines.",
                quantum: "COLLAPSED",
                timeline: "FRACTURED",
                paradoxes: 15
            }
        };
        
        function updateMetrics() {
            let quantumStatus = 'STABLE';
            if (gameState.quantumStability > 90) quantumStatus = 'ENHANCED';
            else if (gameState.quantumStability > 70) quantumStatus = 'STABLE';
            else if (gameState.quantumStability > 50) quantumStatus = 'UNSTABLE';
            else if (gameState.quantumStability > 30) quantumStatus = 'CRITICAL';
            else quantumStatus = 'COLLAPSED';
            
            let timelineStatus = 'PRIMARY';
            if (gameState.timelineIntegrity > 95) timelineStatus = 'PRIME';
            else if (gameState.timelineIntegrity > 80) timelineStatus = 'PRIMARY';
            else if (gameState.timelineIntegrity > 60) timelineStatus = 'FRACTURED';
            else if (gameState.timelineIntegrity > 40) timelineStatus = 'UNSTABLE';
            else timelineStatus = 'COLLAPSED';
            
            let paradoxLevel = 'NONE';
            if (gameState.paradoxes === 0) paradoxLevel = 'NONE';
            else if (gameState.paradoxes <= 2) paradoxLevel = 'MINOR';
            else if (gameState.paradoxes <= 5) paradoxLevel = 'MODERATE';
            else if (gameState.paradoxes <= 10) paradoxLevel = 'SEVERE';
            else paradoxLevel = 'CRITICAL';
            
            document.getElementById('quantumStability').textContent = `⚛ QUANTUM: ${quantumStatus}`;
            document.getElementById('timelineStatus').textContent = `⏰ TIMELINE: ${timelineStatus}`;
            document.getElementById('paradoxLevel').textContent = `⚠ PARADOX: ${paradoxLevel}`;
        }
        
        function addMessage(type, text, delay = 0) {
            setTimeout(() => {
                const messageArea = document.getElementById('messageArea');
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${type}`;
                messageDiv.innerHTML = `<p>${text}</p>`;
                messageArea.appendChild(messageDiv);
                messageArea.scrollTop = messageArea.scrollHeight;
            }, delay);
        }
        
        function showTypingIndicator() {
            const messageArea = document.getElementById('messageArea');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message system typing-indicator';
            typingDiv.id = 'typing';
            typingDiv.innerHTML = '<p>Processing quantum calculations...</p>';
            messageArea.appendChild(typingDiv);
            messageArea.scrollTop = messageArea.scrollHeight;
        }
        
        function hideTypingIndicator() {
            const typing = document.getElementById('typing');
            if (typing) typing.remove();
        }
        
        function makeChoice(choice) {
            if (!gameState.isUnlocked && gameState.currentScene >= 2) {
                showPaywall();
                return;
            }
            
            gameState.choices.push(choice);
            
            const currentStory = storyData[gameState.currentScene];
            const choiceData = currentStory[choice];
            
            // Hide choices
            document.getElementById('choices').style.display = 'none';
            
            // Show typing indicator
            showTypingIndicator();
            
            // Add choice message
            setTimeout(() => {
                hideTypingIndicator();
                addMessage('user-choice', choiceData.messages[0].text);
                
                // Add subsequent messages with delays
                choiceData.messages.slice(1).forEach((message, index) => {
                    addMessage(message.type, message.text, (index + 1) * 2000);
                });
                
                // Update game state
                setTimeout(() => {
                    gameState.quantumStability += choiceData.quantumChange;
                    gameState.timelineIntegrity += choiceData.timelineChange;
                    gameState.paradoxes += choiceData.paradoxChange;
                    
                    // Clamp values
                    gameState.quantumStability = Math.max(0, Math.min(100, gameState.quantumStability));
                    gameState.timelineIntegrity = Math.max(0, Math.min(100, gameState.timelineIntegrity));
                    gameState.paradoxes = Math.max(0, gameState.paradoxes);
                    
                    updateMetrics();
                    
                    // Move to next scene or end
                    gameState.currentScene = choiceData.nextScene;
                    
                    if (typeof gameState.currentScene === 'string' || gameState.currentScene > 7 || gameState.quantumStability <= 0) {
                        setTimeout(() => endScenario(), 1500);
                    } else {
                        setTimeout(() => showNextChoices(), 1500);
                    }
                }, choiceData.messages.length * 2000);
            }, 1500);
        }
        
        function showNextChoices() {
            const currentStory = storyData[gameState.currentScene];
            if (!currentStory) {
                endScenario();
                return;
            }
            
            const choicesDiv = document.getElementById('choices');
            choicesDiv.innerHTML = '';
            
            Object.keys(currentStory).forEach(choice => {
                const button = document.createElement('button');
                button.className = 'choice-button';
                button.onclick = () => makeChoice(choice);
                
                const choiceText = getChoiceText(gameState.currentScene, choice);
                button.innerHTML = `<span class="choice-timer">120s</span>${choiceText}`;
                
                choicesDiv.appendChild(button);
            });
            
            choicesDiv.style.display = 'flex';
        }
        
        function getChoiceText(scene, choice) {
            const choiceTexts = {
                2: {
                    contain_breach: "Activate secondary containment protocols",
                    evacuate_facility: "Evacuate the facility and let the breach run its course"
                },
                3: {
                    merge_timelines: "Attempt to merge your consciousness across timelines",
                    isolate_paradox: "Isolate the paradox in a quantum bubble"
                },
                4: {
                    study_negative_mass: "Study the negative quantum mass phenomenon",
                    destroy_evidence: "Destroy all evidence of the experiment"
                },
                5: {
                    become_observer: "Accept your role as a multiversal observer",
                    fight_reality: "Fight to maintain your original timeline"
                }
            };
            
            return choiceTexts[scene]?.[choice] || choice;
        }
        
        function endScenario() {
            document.getElementById('choices').style.display = 'none';
            
            // Determine ending based on final scene and metrics
            let ending;
            if (gameState.currentScene === 'breakthrough') {
                ending = endings.breakthrough;
            } else if (gameState.currentScene === 'multiverse') {
                ending = endings.multiverse;
            } else if (gameState.currentScene === 'resistance') {
                ending = endings.resistance;
            } else if (gameState.quantumStability > 50 && gameState.timelineIntegrity > 60) {
                ending = endings.stabilized;
            } else {
                ending = endings.failure;
            }
            
            // Show outcome
            document.getElementById('outcomeTitle').textContent = ending.title;
            document.getElementById('finalQuantum').textContent = ending.quantum;
            document.getElementById('finalTimeline').textContent = ending.timeline;
            document.getElementById('paradoxCount').textContent = ending.paradoxes;
            document.getElementById('outcomeDescription').innerHTML = `<p>${ending.description}</p>`;
            
            setTimeout(() => {
                document.getElementById('outcomeSummary').style.display = 'block';
            }, 2000);
        }
        
        function restartStory() {
            gameState = {
                quantumStability: 100,
                timelineIntegrity: 87,
                paradoxes: 0,
                currentScene: 1,
                choices: [],
                isUnlocked: gameState.isUnlocked
            };
            
            document.getElementById('messageArea').innerHTML = `
                <div class="message system">
                    <p>SYSTEM STATUS: Quantum field destabilizing • Timeline integrity: 87%</p>
                </div>
                
                <div class="message quantum">
                    <p>Emergency protocols activated. The quantum drive has malfunctioned during your consciousness transfer experiment.</p>
                </div>
                
                <div class="message narrator">
                    <p>You're Dr. Alex Chen, lead quantum physicist. Around you, reality flickers between multiple timelines. In one, the lab is destroyed. In another, you never existed. The quantum anchors are failing rapidly.</p>
                </div>
                
                <div class="message temporal">
                    <p>You have approximately 4 minutes before complete timeline collapse. Your next action will determine which reality becomes permanent.</p>
                </div>
            `;
            
            document.getElementById('choices').innerHTML = `
                <button class="choice-button" onclick="makeChoice('emergency_shutdown')">
                    <span class="choice-timer">240s</span>
                    Initiate emergency quantum drive shutdown
                </button>
                
                <button class="choice-button" onclick="makeChoice('stabilize_field')">
                    <span class="choice-timer">240s</span>
                    Attempt to manually stabilize the quantum field
                </button>
            `;
            
            document.getElementById('choices').style.display = 'flex';
            document.getElementById('outcomeSummary').style.display = 'none';
            updateMetrics();
        }
        
        function showPaywall() {
            document.getElementById('paywall').style.display = 'flex';
        }
        
        function unlockStory() {
            gameState.isUnlocked = true;
            document.getElementById('paywall').style.display = 'none';
            
            addMessage('system', 'QUANTUM ACCESS GRANTED: Full temporal protocols now available.');
        }
        
        // Initialize the story
        updateMetrics();
    </script>
</body>
</html>
